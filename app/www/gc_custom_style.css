/* =======================================================================
 GC Design System – Custom styles for Hourly FWI (NG‑CFFDRS)
 Uses GCDS tokens where available with safe fallbacks.
 ======================================================================= */

/* 1) Design tokens & base */
:root {
  --gcds-bg-light: #F1F2F3;
  --gcds-bg-primary: #26374A;
  --gcds-bg-white: #FFFFFF;
  --gcds-text-primary: #333333;
  --gcds-text-secondary: #43474E;
  --gcds-text-light: #FFFFFF;
  --gcds-link-default: #284162;
  --gcds-link-hover: #0535d2;
  --gcds-border-default: #7D828B;
  --gcds-danger-text: #A62A1E;
  --gcds-font-families-body: 'Noto Sans', sans-serif;
  --gcds-font-families-heading: 'Lato', sans-serif;
}
html { font-size: 100%; }
body {
  font-family: var(--gcds-font-families-body, 'Noto Sans', sans-serif);
  background-color: var(--gcds-bg-light);
  color: var(--gcds-text-primary);
  margin: 0;
  padding: 0;
  line-height: 1.6;
}
a {
  color: var(--gcds-link-default);
  text-decoration-thickness: 1.5px;
  text-underline-offset: 2px;
}
a:hover, a:focus { color: var(--gcds-link-hover); }
/* Accessible skip link */
.skip-link {
  position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden;
}
.skip-link:focus,
.skip-link:active {
  position: static; width: auto; height: auto; padding: .5rem .75rem;
  background: #fff; border: 2px solid var(--gcds-link-hover); z-index: 10000;
}
/* Global focus styles */
.form-control:focus-visible,
select:focus-visible,
input:focus-visible,
.btn:focus-visible,
button:focus-visible,
a:focus-visible {
  outline: 3px solid var(--gcds-link-hover);
  outline-offset: 2px;
}
/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}

/* 2) Page chrome (titles, header, footer) */
h1.gc-page-title {
  position: relative; margin: .5rem 1rem .4rem; padding-bottom: .5rem;
  font-family: var(--gcds-font-families-heading, 'Lato', sans-serif); font-weight: 700;
}
h1.gc-page-title::after {
  content: ""; position: absolute; left: 0; bottom: 0; width: 72px; height: 6px;
  background: var(--gcds-danger-text);
}
header .gc-page-title { margin: .4rem 0 .3rem; }
/* Header layout */
.gc-header {
  display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 1rem;
  max-width: 1200px; margin: 0 auto; padding: .5rem 1rem;
}
.gc-header__brand { grid-column: 1; justify-self: start; }
.gc-header__title { grid-column: 2; justify-self: center; text-align: center; margin: 0; }
.gc-header__lang  { grid-column: 3; justify-self: end; }
.gc-header__title { max-width: min(60ch, 90vw); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
/* Footer */
.gc-footer {
  background: var(--gcds-bg-light, #F1F2F3);
  border-top: 1px solid var(--gcds-border-default, #7D828B);
  padding: .5rem 1rem;
  font-family: var(--gcds-font-families-body, 'Noto Sans', sans-serif);
  font-size: 0.875rem;
}
.gc-footer__wrap {
  display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
  max-width: 1200px; margin: 0 auto; gap: .75rem 1rem;
}
.gc-footer__team { display: flex; flex-direction: column; align-items: flex-start; max-width: 420px; }
.gc-footer__team-logo { height: 28px; width: auto; margin-bottom: .25rem; }
.gc-footer__team-text { margin: 0; color: var(--gcds-text-secondary, #43474E); font-size: 0.8125rem; }
.gc-footer__sig { display: flex; flex-direction: column; align-items: flex-end; }
.gc-footer__sig-logo { height: 28px; width: auto; }
.gc-footer__legal { text-align: right; margin-top: .25rem; color: var(--gcds-text-secondary, #43474E); font-size: 0.75rem; }

/* 3) Panels & grids (sidebars, tool rows) */
.sidebarPanel, .mainPanel { background-color: var(--gcds-bg-white); padding: 1rem; }
.sidebarPanel { border-right: 1px solid var(--gcds-border-default); top: .5rem; }
.sidebarPanel h4 { margin: .4rem 0 .3rem; }
.sidebarPanel .form-group { margin-bottom: .5rem; }
/* Side-by-side layout for the two radio groups */
.tz-grid { display:flex; gap: 12px; align-items:flex-start; flex-wrap: wrap; }
.tz-grid .tz-col { flex: 1 1 0; min-width: 220px; }
.tz-grid .shiny-input-container { margin-bottom: 8px; }
.tz-grid .radio { margin-top: 0; margin-bottom: 8px; }
/* Reserve vertical space for mapping UI so layout doesn't jump */
.mapping-block { min-height: 320px; }

/* 4) Forms & buttons */
.form-control,
select,
input[type="text"],
input[type="number"],
input[type="date"] {
  width: 100%; padding: .5rem .75rem; font-size: 1rem;
  border: 1px solid #ccc; border-radius: .25rem; background: #fff; color: var(--gcds-text-primary);
}
.btn-file-label { pointer-events: none; }
/* Buttons (limit to Bootstrap buttons; DT buttons are styled below) */
.btn, .btn-primary {
  background-color: var(--gcds-bg-primary);
  color: var(--gcds-text-light);
  border: 0; border-radius: .25rem; padding: .5rem .75rem; cursor: pointer;
}
.btn:hover, .btn-primary:hover { background-color: var(--gcds-link-hover); }
/* Upload row: compact horizontal layout */
.upload-inline { display:flex; align-items:center; gap: 0px; flex-wrap: wrap; }
.upload-inline .shiny-input-container { margin-bottom: 0; }
#upload-csv_input_ui { flex: 2; }
.upload-checkbox { display:inline-flex; align-items:center; gap: 6px; }
.upload-inline .checkbox { margin: 0; }
.upload-inline input[type="checkbox"] { margin-top: 0; }
.upload-inline .btn { margin-bottom: 0; }


/* 5) Components (cards, placeholder, help, mini-preview, mapping disabled) */
.gc-card {
  padding:.5rem 1rem;
  border:1px solid var(--gcds-border-default, #7D828B);
  border-radius:6px;
  background:#fff;
  margin-bottom:1rem;
  min-height: 98px;
  overflow: visible; /* let DataTables manage its own scroll */
}
.gc-card__content { position: relative; }
.gc-card .dataTables_wrapper { 
  max-width:100%;
  overflow-x:auto;
}
/* NOTE: removed overflow:hidden; allow DT to manage widths for header/body sync */
/* .gc-card .dataTables_wrapper .dataTables_scroll { overflow:hidden; } */

/* Placeholder region used before results are available */
.gc-placeholder {
  display: flex; align-items: center; justify-content: center;
  min-height: 220px; width: 100%; flex-direction: column; gap: .5rem;
}
.gc-placeholder__text {
  font-size: .95rem; color: var(--gcds-text-secondary, #43474E);
  margin-top: .35rem; position: relative; z-index: 1;
}
/* Hide the placeholder ONLY while spinner visible and after a DT exists */
.gc-card__content:has(.shiny-spinner-output-container .load-container:not(.shiny-spinner-hidden)) .gc-placeholder,
.gc-card:has(.dataTables_wrapper) .gc-placeholder {
  display: none;
}
/* Keep the card height stable while spinner overlay is visible */
.gc-card__content:has(.shiny-spinner-output-container .load-container:not(.shiny-spinner-hidden)) .shiny-spinner-output-container {
  min-height: 220px; /* match placeholder height */
  position: relative;
}

/* Help icon */
.help-icon {
  display:inline-flex; align-items:center; justify-content:center;
  width:1.15em; height:1.15em; margin-left:.35rem; font-weight:700;
  border:1px solid var(--gcds-border-default, #7D828B); border-radius:50%;
  color:var(--gcds-text-primary, #333); background:var(--gcds-bg-white, #fff);
  cursor:help; font-size:.8em; line-height:1; text-decoration:none; user-select:none;
}
.help-icon:focus { outline:2px solid var(--gcds-link-hover, #0535d2); outline-offset:2px; }

/* Click-to-open rich help */
.help-disclosure { display:inline-block; position:relative; margin-left:.35rem; }
.help-disclosure>summary {
  list-style:none; display:inline-flex; align-items:center; justify-content:center;
  width:1.15em; height:1.15em; font-weight:700; font-size:.8em; line-height:1;
  border:1px solid var(--gcds-border-default, #7D828B); border-radius:50%;
  color:var(--gcds-text-primary, #333); background:var(--gcds-bg-white, #fff);
  cursor:pointer; user-select:none;
}
.help-disclosure>summary::-webkit-details-marker { display:none; }
.help-disclosure>summary:focus { outline:2px solid var(--gcds-link-hover, #0535d2); outline-offset:2px; }
.help-panel {
  position:absolute; z-index:1000; top:1.6em; left:0; min-width:240px; max-width:420px;
  padding:.5rem .75rem; border:1px solid var(--gcds-border-default, #7D828B); border-radius:.35rem;
  background:#fff; color:#333; box-shadow:0 6px 16px rgba(0,0,0,.12);
}
.help-panel p { margin:0 0 .5rem; }
.help-panel ul { margin:.25rem 0 .25rem 1.15rem; }
.help-panel table { width:100%; border-collapse:collapse; font-size:.875rem; }
.help-panel th, .help-panel td {
  border:1px solid var(--gcds-border-default, #7D828B); padding:.25rem .4rem; vertical-align:top;
}
.help-panel th { background:var(--gcds-bg-light, #F1F2F3); text-align:left; }

/* Small data preview under Column mapping */
.mini-preview { margin:.25rem 0 .5rem; }
.mini-preview__title { display:block; font-size:.85rem; color:var(--gcds-text-secondary, #43474E); margin-bottom:.25rem; }
.mini-preview__wrap { overflow-x:auto; border:1px solid var(--gcds-border-default, #7D828B); border-radius:.25rem; }
.mini-preview table { width:100%; border-collapse:collapse; font-size:.8rem; }
.mini-preview th, .mini-preview td {
  border:1px solid var(--gcds-border-default, #7D828B);
  padding:.2rem .35rem; white-space:nowrap; text-overflow:ellipsis; overflow:hidden;
}
.mini-preview th { background:var(--gcds-bg-light, #F1F2F3); text-align:left; }

/* Mapping controls disabled state */
.mapping-ui-fieldset[disabled] { opacity: 0.6; }
.mapping-ui-fieldset[disabled] * { cursor: not-allowed !important; }
.mapping-ui-fieldset[disabled] .selectize-control { pointer-events: none; }

/* Progress tweaks */
.progress { margin-bottom: 0px; height: auto; }

/* Screen-reader only utility */
.sr-only {
  position:absolute !important; width:1px !important; height:1px !important;
  padding:0 !important; margin:-1px !important; overflow:hidden !important;
  clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
}

/* 6) DataTables styling */
table.dataTable.gc-dt thead th {
  background-color: var(--gcds-bg-light, #F1F2F3);
  color: var(--gcds-text-primary, #333333);
  border-bottom: 2px solid var(--gcds-border-default, #7D828B);
  font-weight: 700;
  font-family: var(--gcds-font-families-heading, 'Lato', sans-serif);
}
table.dataTable.gc-dt tbody td {
  font-family: var(--gcds-font-families-body, 'Noto Sans', sans-serif);
  color: var(--gcds-text-primary, #333333);
}
table.dataTable.gc-dt.stripe tbody tr:nth-child(even) { background-color: #fafafa; }
.dataTables_wrapper .dataTables_filter input,
.dataTables_wrapper .dataTables_length select {
  border: 1px solid var(--gcds-border-default, #7D828B);
  border-radius: .25rem;
  padding: .25rem .5rem;
  font-family: var(--gcds-font-families-body, 'Noto Sans', sans-serif);
}
.dataTables_wrapper .dt-buttons .dt-button {
  background-color: var(--gcds-bg-primary, #26374A);
  color: var(--gcds-text-light, #fff);
  border: none; border-radius: .25rem; padding: .35rem .6rem;
}
.dataTables_wrapper .dt-buttons .dt-button:hover,
.dataTables_wrapper .dt-buttons .dt-button:focus {
  background-color: var(--gcds-link-hover, #0535d2);
}

/* Horizontal scroll lives inside the card */
.gc-card table.dataTable { width: 100% !important; }
.gc-card .dataTables_wrapper .dataTables_scrollBody {
  overflow-y: auto !important;  /* no vertical scroll inside card */
  overflow-x: auto !important;  /* allow horizontal scroll if needed */
  width: 100% !important;
}

/* Optional: allow wrapping on narrow viewports even with "nowrap" DT class */
@media (max-width: 768px) {
  .gc-dt td, .gc-dt th { white-space: normal; }
}

/* 7) Responsive tweaks */
@media (max-width: 600px) {
  .gc-header {
    grid-template-columns: max-content 1fr;
    grid-template-areas: 'brand lang' 'title title';
  }
  .gc-header__brand { grid-area: brand; }
  .gc-header__lang  { grid-area: lang; justify-self: end; }
  .gc-header__title { grid-area: title; justify-self: center; }
  .gc-footer__wrap  { align-items: flex-start; }
  .gc-footer__sig   { align-items: flex-start; }
  .gc-footer__legal { text-align: left; }
}
@media (max-width: 480px){
  .tz-grid .tz-col { min-width: 100%; }
}

/* Simple spinner used by the Run modal */
.gc-spinner {
  width: 18px; 
  height: 18px;
  border: 2px solid #ccc;
  border-top-color: #2e6f40; /* forest-ish */
  border-radius: 50%;
  animation: gc-spin 0.8s linear infinite;
}
@keyframes gc-spin { to { transform: rotate(360deg); } }

/* Spinner overlay container for any Shiny output */
.gc-spin-wrap {
  position: relative; /* anchor overlay to output area */
  container-type: inline-size;
}

/* The overlay itself: centered spinner + optional scrim */
.gc-spin-overlay {
  position: absolute;
  inset: 0;
  display: none;             /* default hidden */
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.6); /* subtle scrim; tweak or remove */
  z-index: 2;
}

/* When Shiny marks the output as recalculating, show the overlay */
.gc-spin-wrap .shiny-bound-output.recalculating ~ .gc-spin-overlay {
  display: flex;
}

/* Make sure the output area reserves some space before first draw (optional) */
.gc-spin-wrap .shiny-bound-output {
  min-height: 220px; /* harmonize with your placeholder height */
}


.gc-spin-wrap .gc-spinner {
  --gc-spin-size: clamp(20px, 8cqw, 80px);
  --gc-spin-border: max(2px, calc(var(--gc-spin-size) / 12));
  width: var(--gc-spin-size);
  height: var(--gc-spin-size);
  border-width: var(--gc-spin-border);
}

role="region"][aria-label="FWI plots"] .gc-spinner {
  --gc-spin-size: clamp(28px, 10cqw, 96px);
  --gc-spin-border: max(3px, calc(var(--gc-spin-size) / 12));
}

/* Optional: slow the animation for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
  .gc-spinner { animation-duration: 1.6s; }

